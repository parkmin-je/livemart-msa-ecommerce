apiVersion: v1
kind: ConfigMap
metadata:
  name: livemart-config
  namespace: livemart
data:
  # ── Spring Boot 환경변수 오버라이드 (application.yml localhost 대체) ──

  # Eureka
  EUREKA_CLIENT_SERVICEURL_DEFAULTZONE: "http://eureka-server:8761/eureka/"
  EUREKA_SERVER_URL: "http://eureka-server:8761/eureka/"

  # Kafka
  SPRING_KAFKA_BOOTSTRAP_SERVERS: "kafka:9092"
  KAFKA_BOOTSTRAP_SERVERS: "kafka:9092"

  # Redis
  SPRING_DATA_REDIS_HOST: "redis"
  SPRING_DATA_REDIS_PORT: "6379"
  REDIS_HOST: "redis"
  REDIS_PORT: "6379"

  # Zipkin (Distributed Tracing)
  MANAGEMENT_ZIPKIN_TRACING_ENDPOINT: "http://zipkin:9411/api/v2/spans"
  ZIPKIN_ENDPOINT: "http://zipkin:9411/api/v2/spans"

  # Elasticsearch
  SPRING_ELASTICSEARCH_URIS: "http://elasticsearch:9200"

  # Inter-service URLs
  SERVICE_PRODUCT_URL: "http://product-service:8082"
  SERVICE_PAYMENT_URL: "http://payment-service:8084"
  SERVICE_INVENTORY_URL: "http://user-service:8085"
  SERVICE_ORDER_URL: "http://order-service:8083"

  # PostgreSQL - 각 서비스 DB 호스트 (클러스터 내부 서비스명)
  USER_DB_HOST: "postgres-user"
  USER_DB_PORT: "5432"

  PRODUCT_DB_HOST: "postgres-product"
  PRODUCT_DB_PORT: "5432"

  ORDER_DB_HOST: "postgres-order"
  ORDER_DB_PORT: "5432"

  PAYMENT_DB_HOST: "postgres-payment"
  PAYMENT_DB_PORT: "5432"
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: prometheus-config
  namespace: livemart
data:
  prometheus.yml: |
    global:
      scrape_interval: 15s
      evaluation_interval: 15s

    scrape_configs:
      - job_name: 'eureka-server'
        metrics_path: '/actuator/prometheus'
        static_configs:
          - targets: ['eureka-server:8761']

      - job_name: 'api-gateway'
        metrics_path: '/actuator/prometheus'
        static_configs:
          - targets: ['api-gateway:8080']

      - job_name: 'user-service'
        metrics_path: '/actuator/prometheus'
        static_configs:
          - targets: ['user-service:8085']

      - job_name: 'product-service'
        metrics_path: '/actuator/prometheus'
        static_configs:
          - targets: ['product-service:8082']

      - job_name: 'order-service'
        metrics_path: '/actuator/prometheus'
        static_configs:
          - targets: ['order-service:8083']

      - job_name: 'payment-service'
        metrics_path: '/actuator/prometheus'
        static_configs:
          - targets: ['payment-service:8084']
